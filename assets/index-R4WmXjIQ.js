(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();class v{canvas;ctx;width=0;height=0;dpr=window.devicePixelRatio||1;constructor(t){const e=document.getElementById(t),o=e.getContext("2d");if(!o)throw new Error("Canvas not supported");this.canvas=e,this.ctx=o}resize(t,e){this.width=t,this.height=e,this.canvas.width=Math.floor(t*this.dpr),this.canvas.height=Math.floor(e*this.dpr),this.canvas.style.width=`${t}px`,this.canvas.style.height=`${e}px`,this.ctx.setTransform(this.dpr,0,0,this.dpr,0,0)}clear(){this.ctx.clearRect(0,0,this.width,this.height)}}class P{current=null;async set(t){this.current?.onExit&&this.current.onExit(),this.current=t,this.current.onEnter&&await this.current.onEnter()}get currentScene(){return this.current}update(t){this.current?.update(t)}render(){this.current?.render()}onPointerDown(t){this.current?.onPointerDown?.(t)}onPointerMove(t){this.current?.onPointerMove?.(t)}onPointerUp(t){this.current?.onPointerUp?.(t)}}class b{constructor(t,e,o,i){t.addEventListener("pointerdown",s=>{e(this.getPoint(s,t))}),t.addEventListener("pointermove",s=>{o(this.getPoint(s,t))}),t.addEventListener("pointerup",s=>{i(this.getPoint(s,t))})}getPoint(t,e){const o=e.getBoundingClientRect();return{x:t.clientX-o.left,y:t.clientY-o.top}}}class I{sceneManager=new P;lastTime=performance.now();constructor(t){new b(t,e=>this.sceneManager.onPointerDown(e),e=>this.sceneManager.onPointerMove(e),e=>this.sceneManager.onPointerUp({x:0,y:0}))}start(){requestAnimationFrame(this.loop)}loop=t=>{const e=(t-this.lastTime)/1e3;this.lastTime=t,this.sceneManager.update(e),this.sceneManager.render(),requestAnimationFrame(this.loop)}}class B{ui;onStart;constructor(t,e){this.ui=t,this.onStart=e}update(){}render(){const t=this.ui.ctx;this.ui.clear(),t.fillStyle="white",t.font="32px monospace",t.textAlign="center",t.fillText("REDACT-TED",this.ui.width/2,this.ui.height/2-40),t.font="20px monospace",t.fillText("Click to Begin",this.ui.width/2,this.ui.height/2+20)}onPointerDown(){this.onStart()}}const n={Prompt:"Prompt",Redacting:"Redacting",Scoring:"Scoring"};class D{debugMode=!1;docLayer;redactionLayer;uiLayer;docImage=new Image;imageLoaded=!1;layout;strokes=[];isDrawing=!1;markerColor="yellow";markerRadiusNorm=.012;coverageCanvas=document.createElement("canvas");coverageCtx=this.coverageCanvas.getContext("2d");phase=n.Prompt;timer=0;timeLimit=30;roundScore=0;totalScore=0;needsRedraw=!0;masks;currentMaskIndex=0;prompt="";mask;readyButton;doneButton;continueButton;exitButton;onExit;constructor(t,e,o,i,s){this.docLayer=t,this.redactionLayer=e,this.uiLayer=o,this.masks=[...i].sort(()=>Math.random()-.5),this.onExit=s,this.loadNextMask()}update(t){if(this.phase===n.Redacting){const e=Math.ceil(this.timer);this.timer-=t,this.timer<=0&&(this.timer=0,this.finishRound()),Math.ceil(this.timer)!==e&&(this.needsRedraw=!0)}}render(){!this.imageLoaded||!this.needsRedraw||(this.docLayer.clear(),this.redactionLayer.clear(),this.uiLayer.clear(),(this.phase===n.Redacting||this.phase===n.Scoring)&&(this.drawDocument(),this.drawRedactions()),this.drawUI(),this.needsRedraw=!1)}onResize(){this.imageLoaded&&(this.computeLayout(),this.needsRedraw=!0)}onPointerDown(t){if(t)switch(this.phase){case n.Prompt:this.readyButton&&this.pointInRect(t,this.readyButton)&&this.startRedaction();break;case n.Redacting:this.doneButton&&this.pointInRect(t,this.doneButton)?this.finishRound():this.startStroke(t);break;case n.Scoring:this.continueButton&&this.pointInRect(t,this.continueButton)?this.loadNextMask():this.exitButton&&this.pointInRect(t,this.exitButton)&&this.exitGame();break}}onPointerMove(t){!this.isDrawing||this.phase!==n.Redacting||this.addStroke(t)}onPointerUp(){this.isDrawing=!1}onKeyDown(t){t.key.toLowerCase()==="d"&&(this.debugMode=!this.debugMode,this.needsRedraw=!0)}startRedaction(){this.phase=n.Redacting,this.timer=this.timeLimit,this.strokes=[],this.coverageCtx.clearRect(0,0,this.coverageCanvas.width,this.coverageCanvas.height),this.needsRedraw=!0}finishRound(){this.phase=n.Scoring,this.roundScore=this.calculateScore(),this.totalScore+=this.roundScore,this.needsRedraw=!0}loadNextMask(){this.currentMaskIndex>=this.masks.length&&(this.currentMaskIndex=0),this.mask=this.masks[this.currentMaskIndex++],this.prompt=this.mask.prompt,this.loadDocument(this.mask.imageSrc),this.phase=n.Prompt,this.strokes=[],this.coverageCtx.clearRect(0,0,this.coverageCanvas.width,this.coverageCanvas.height),this.needsRedraw=!0}exitGame(){this.roundScore=0,this.totalScore=0,this.strokes=[],this.phase=n.Prompt,this.docLayer.clear(),this.redactionLayer.clear(),this.uiLayer.clear(),this.coverageCtx.clearRect(0,0,this.coverageCanvas.width,this.coverageCanvas.height),this.needsRedraw=!0,this.onExit()}resetGame(){this.roundScore=0,this.totalScore=0,this.currentMaskIndex=0,this.strokes=[],this.coverageCtx.clearRect(0,0,this.coverageCanvas.width,this.coverageCanvas.height),this.loadNextMask()}startStroke(t){const e=this.screenToDocument(t);e&&(this.isDrawing=!0,this.strokes.push(e),this.drawCoveragePoint(e),this.needsRedraw=!0)}addStroke(t){const e=this.screenToDocument(t);e&&(this.strokes.push(e),this.drawCoveragePoint(e),this.needsRedraw=!0)}computeLayout(){const t=this.docLayer.canvas.getBoundingClientRect(),e=Math.min(t.width/this.docImage.width,t.height/this.docImage.height),o=this.docImage.width*e,i=this.docImage.height*e,s=(t.width-o)/2,r=(t.height-i)/2;this.layout={scale:e,offsetX:s,offsetY:r,drawWidth:o,drawHeight:i}}screenToDocument(t){const{offsetX:e,offsetY:o,drawWidth:i,drawHeight:s}=this.layout,r=(t.x-e)/i,c=(t.y-o)/s;return r<0||r>1||c<0||c>1?null:{x:r,y:c}}documentToScreen(t){const{offsetX:e,offsetY:o,drawWidth:i,drawHeight:s}=this.layout;return{x:t.x*i+e,y:t.y*s+o}}drawDocument(){const{ctx:t}=this.docLayer,{offsetX:e,offsetY:o,drawWidth:i,drawHeight:s}=this.layout;t.drawImage(this.docImage,e,o,i,s)}drawRedactions(){const t=this.redactionLayer.ctx;t.fillStyle=this.markerColor;const e=this.markerRadiusNorm*this.layout.drawWidth;for(const o of this.strokes){const i=this.documentToScreen(o);t.beginPath(),t.arc(i.x,i.y,e,0,Math.PI*2),t.fill()}}drawUI(){const t=this.uiLayer.ctx,e=this.uiLayer.width,o=this.uiLayer.height;if(t.font="20px sans-serif",t.textAlign="center",t.textBaseline="middle",this.debugMode){t.fillStyle="white",t.font="bold 18px sans-serif",t.fillText(this.prompt,e/2,20),t.strokeStyle="red",t.lineWidth=2;for(const i of this.mask.targetRects){const s=i.x*this.layout.drawWidth+this.layout.offsetX,r=i.y*this.layout.drawHeight+this.layout.offsetY,c=i.width*this.layout.drawWidth,d=i.height*this.layout.drawHeight;t.strokeRect(s,r,c,d)}}switch(this.phase){case n.Prompt:t.fillStyle="white",t.fillText(this.prompt,e/2,o*.25),this.readyButton=this.drawButton("READY",e/2,o*.35);break;case n.Redacting:t.textAlign="left",t.fillStyle="yellow",t.fillText(`Time: ${Math.ceil(this.timer)}`,20,30),this.doneButton=this.drawButton("DONE",e-80,30);break;case n.Scoring:const i=e/2;if(this.drawLabel(`Round Score: ${this.roundScore}`,i,o*.28,{bgColor:"rgba(0,0,0,0.75)",textColor:"#7CFF7C",font:"bold 22px sans-serif"}),this.drawLabel(`Total Score: ${this.totalScore}`,i,o*.36,{bgColor:"rgba(0,0,0,0.75)",textColor:"white"}),this.continueButton=this.drawButton("CONTINUE",i,o*.5),this.exitButton=this.drawButton("EXIT",i,o*.57),this.debugMode){t.strokeStyle="red",t.lineWidth=2;for(const s of this.mask.targetRects){const r=s.x*this.layout.drawWidth+this.layout.offsetX,c=s.y*this.layout.drawHeight+this.layout.offsetY,d=s.width*this.layout.drawWidth,l=s.height*this.layout.drawHeight;t.strokeRect(r,c,d,l)}}break}}drawButton(t,e,o){const i=this.uiLayer.ctx,s=140,r=40;return i.fillStyle="#444",i.fillRect(e-s/2,o-r/2,s,r),i.fillStyle="white",i.font="20px sans-serif",i.textAlign="center",i.textBaseline="middle",i.fillText(t,e,o),{x:e-s/2,y:o-r/2,width:s,height:r,text:t}}drawLabel(t,e,o,i){const s=this.uiLayer.ctx,r=i?.font??"20px sans-serif";s.font=r,s.textBaseline="middle";const d=s.measureText(t).width+16,l=parseInt(s.font,10)+12;s.fillStyle=i?.bgColor??"rgba(0,0,0,0.65)",s.fillRect(e-d/2,o-l/2,d,l),s.fillStyle=i?.textColor??"white",s.fillText(t,e,o)}pointInRect(t,e){return!t||!("x"in t)||!e?!1:t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height}drawCoveragePoint(t){const e=this.coverageCtx,o=this.markerRadiusNorm*this.coverageCanvas.width;e.fillStyle="white",e.beginPath(),e.arc(t.x*this.coverageCanvas.width,t.y*this.coverageCanvas.height,o,0,Math.PI*2),e.fill()}calculateScore(){const{targetRects:t}=this.mask,e=this.coverageCanvas.width,o=this.coverageCanvas.height,i=this.coverageCtx.getImageData(0,0,e,o).data,s=4;let r=0,c=0,d=0;for(let a=0;a<o;a+=s)for(let u=0;u<e;u+=s){const f=(a*e+u)*4;if(i[f+3]===0)continue;t.some(g=>u>=g.x*e&&a>=g.y*o&&u<=(g.x+g.width)*e&&a<=(g.y+g.height)*o)?r++:d++}for(const a of t){const u=Math.floor(a.x*e),f=Math.ceil((a.x+a.width)*e),S=Math.floor(a.y*o),g=Math.ceil((a.y+a.height)*o);for(let y=S;y<g;y+=s)for(let x=u;x<f;x+=s){const k=(y*e+x)*4;i[k+3]===0&&c++}}let l=r*20-d*1.5-c*.5;if(this.phase===n.Scoring){const a=Math.max(0,this.timer/this.timeLimit);l+=l*a*.5}return Math.max(0,Math.round(l))}loadDocument(t){this.docImage.onload=()=>{this.imageLoaded=!0,this.coverageCanvas.width=this.docImage.width,this.coverageCanvas.height=this.docImage.height,this.computeLayout(),this.needsRedraw=!0},this.docImage.src=t}}const T=[{prompt:"Remove all traces of Greg",imageSrc:"assets/documents/venison-pirates.png",targetRects:[{x:.1332630772178577,y:.498371335504886,width:.05761001468991506,height:.023887079261672106},{x:.1318579549083476,y:.3116178067318133,width:.07306636009452641,height:.08577633007600433},{x:.06019671712333131,y:.7937024972855592,width:.03653318004726321,height:.015200868621064068}]},{prompt:"Remove all traces of Joan",imageSrc:"assets/documents/venison-pirates.png",targetRects:[{x:.3608928913584977,y:.500542888165038,width:.04917928083285428,height:.018458197611292082},{x:.3496519128824167,y:.31813246471226925,width:.06323050392795554,height:.07600434310532034},{x:.3594877690489876,y:.3973941368078176,width:.040748546975793554,height:.026058631921824116},{x:.1079708756466755,y:.7958740499457112,width:.033722935428242964,height:.010857763300760048}]},{prompt:"Remove all traces of Captain John",imageSrc:"assets/documents/venison-pirates.png",targetRects:[{x:.5674458708564858,y:.4212812160694897,width:.10538417321325932,height:.04017372421281212},{x:.5379383023567732,y:.500542888165038,width:.1545634540461136,height:.017372421281216077},{x:.15293478955099946,y:.7947882736156352,width:.09976368397521876,height:.013029315960912058}]},{prompt:"Remove all traces of Johnny",imageSrc:"assets/documents/venison-pirates.png",targetRects:[{x:.84284984352047,y:.33659066232356133,width:.033722935428243006,height:.04668838219326821},{x:.796480807306636,y:.500542888165038,width:.08149709395158711,height:.018458197611292082},{x:.296257265121032,y:.7937024972855592,width:.05761001468991506,height:.014115092290988063}]},{prompt:"Remove all traces of Gloot",imageSrc:"assets/documents/gloot.png",targetRects:[{x:.1079708756466755,y:.36699239956568946,width:.08430733857060739,height:.04234527687296419},{x:.13045283259883747,y:.501628664495114,width:.06463562623746569,height:.015200868621064068},{x:.06019671712333131,y:.6905537459283387,width:.04917928083285431,height:.013029315960912058}]},{prompt:"Remove all traces of Kevin",imageSrc:"assets/documents/gloot.png",targetRects:[{x:.3496519128824167,y:.3257328990228013,width:.08149709395158716,height:.019543973941368087},{x:.35386727981094707,y:.501628664495114,width:.06604074854697584,height:.016286644951140072},{x:.5435587915948138,y:.752442996742671,width:.05198952545187452,height:.015200868621064068}]},{prompt:"Remove all traces of Klootz",imageSrc:"assets/documents/gloot.png",targetRects:[{x:.5632305039279555,y:.3289902280130293,width:.1110046624512997,height:.07383279044516833},{x:.5758766047135466,y:.499457111834962,width:.07587660471354662,height:.018458197611292082},{x:.8751676566392028,y:.6894679695982627,width:.05761001468991511,height:.014115092290988063}]},{prompt:"Remove all traces of Yo'Pil",imageSrc:"assets/documents/gloot.png",targetRects:[{x:.8667369227821421,y:.3572204125950054,width:.033722935428243006,height:.03148751357220414},{x:.8133422750207574,y:.3789359391965255,width:.04777415852334421,height:.021715526601520097},{x:.8063166634732069,y:.49728555917481,width:.06463562623746566,height:.02062975027144409},{x:.7360605479977006,y:.7100977198697068,width:.050584403142364454,height:.015200868621064068}]},{prompt:"Remove all traces of Dr. Gwen",imageSrc:"assets/documents/science.png",targetRects:[{x:.12764258797981723,y:.3702497285559175,width:.06744587085648593,height:.06731813246471224},{x:.10656575333716538,y:.501628664495114,width:.1081944178322795,height:.017372421281216077},{x:.4578463307146962,y:.7198697068403909,width:.09695343935619855,height:.018458197611292082}]},{prompt:"Remove all traces of Dr. Schmorgusboard",imageSrc:"assets/documents/science.png",targetRects:[{x:.35667752442996736,y:.3724212812160695,width:.04777415852334416,height:.05103148751357223},{x:.29906750974005225,y:.498371335504886,width:.17001979945072493,height:.02062975027144409},{x:.35246215750143695,y:.5266015200868621,width:.06604074854697584,height:.019543973941368087},{x:.341221179025356,y:.742671009771987,width:.1643993102126844,height:.013029315960912058}]},{prompt:"Remove all traces of Dr. Handd",imageSrc:"assets/documents/science.png",targetRects:[{x:.5829022162610972,y:.3767643865363735,width:.050584403142364454,height:.02931596091205213},{x:.5533946477613846,y:.500542888165038,width:.12224564092738077,height:.017372421281216077},{x:.3117136105256434,y:.762214983713355,width:.09414319473717825,height:.015200868621064068}]},{prompt:"Remove all traces of Bubble Burger",imageSrc:"assets/documents/science.png",targetRects:[{x:.06160183943284143,y:.6134636264929425,width:.12927125247493135,height:.01845819761129197}]},{prompt:"Remove all traces of Billy the Snacker",imageSrc:"assets/documents/banditos.png",targetRects:[{x:-.30372996103979066,y:.051031487513572206,width:0,height:0},{x:.12202209874177673,y:.38219326818675353,width:.04074854697579357,height:.0445168295331162},{x:.06722232867088192,y:.500542888165038,width:.19250175640288691,height:.019543973941368087},{x:.06160183943284143,y:.747014115092291,width:.15175320942709333,height:.014115092290988063}]},{prompt:"Remove all traces of Gorgonzola",imageSrc:"assets/documents/banditos.png",targetRects:[{x:.32154946669221424,y:.50271444082519,width:.13348661940346174,height:.014115092290988063},{x:.3356006897873155,y:.36156351791530944,width:.07728172702305675,height:.05211726384364823},{x:.6461327201890528,y:.7687296416938111,width:.10397905090374915,height:.014115092290988063}]},{prompt:"Remove all traces of Roger Cheddar Fingers",imageSrc:"assets/documents/banditos.png",targetRects:[{x:.5744714824040364,y:.3735070575461455,width:.03653318004726325,height:.028230184581976125},{x:.546369036213834,y:.49728555917481,width:.13348661940346163,height:.016286644951140072},{x:.5829022162610972,y:.5200868621064061,width:.06182538161844542,height:.015200868621064068},{x:.06160183943284143,y:.7263843648208469,width:.21217346873602866,height:.016286644951140072}]}],C=new v("doc"),L=new v("redaction"),w=new v("ui"),m=new I(w.canvas);function M(){const h=window.innerWidth,t=window.innerHeight;C.resize(h,t),L.resize(h,t),w.resize(h,t),m.sceneManager.currentScene?.onResize?.()}window.addEventListener("resize",M);M();let R,p;p=new D(C,L,w,T,()=>{m.sceneManager.set(R)});R=new B(w,()=>{p.resetGame(),m.sceneManager.set(p)});m.sceneManager.set(R);m.start();window.addEventListener("keydown",h=>{m.sceneManager.currentScene?.onKeyDown?.(h)});
